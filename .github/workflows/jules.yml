name: Jules Agent

on:
  issues:
    types: [labeled]
  issue_comment:
    types: [created]

jobs:
  solve-issue:
    if: >
      github.actor == 'hdkiller' &&
      (
        (github.event_name == 'issues' && github.event.label.name == 'Jules') ||
        (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@Jules'))
      )
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: read
    steps:
      - name: Invoke Jules
        uses: google-labs-code/jules-action@v1.0.0
        with:
          jules_api_key: ${{ secrets.JULES_API_KEY }}
          starting_branch: master
          prompt: |
            You are an expert software engineer working on the repository ${{ github.repository }}.

            Please resolve the following issue:

            Issue Title: ${{ github.event.issue.title }}
            Issue Description:
            ${{ github.event.issue.body }}

            ${{ github.event_name == 'issue_comment' && format('User Instruction: {0}', github.event.comment.body) || '' }}

            Constraints & Instructions:
            - Read GEMINI.md and RULES.md to understand the project conventions and guidelines.
            - Do NOT pull docker containers.
            - Do NOT test the web UI manually or via E2E (the user will test it).
            - Write unit tests when possible.
            - You can run unit tests to verify your changes.

            Please implement the necessary changes and create a Pull Request.
